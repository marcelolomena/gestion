@()(implicit session: play.api.mvc.Session,lang:Lang,req : play.api.mvc.RequestHeader) 
@import play.api.i18n._
@import play.api._
@import services._
@import helper._

@frontend.layout()
<style type="text/css" media="screen">
    th.ui-th-column div{
        white-space:normal !important;
        height:auto !important;
        padding:2px;
    }
    tr.jqgroup td {
    	font-weight: bold !important; font-size: 12px;
	}
</style>
</head>
<body>
@frontend.topLayout()
<div class="main">
	@frontend.header()
	<section class="slider" id="panel_page">

		<div class="product_main">
		  	<div class="product_detail_1">
		  	
			<div id="accordion"> 
				<h3><a id="burbujas" href="#">Gráfico SPI/CPI</a></h3> 
				<div> 
						<div id="container"></div>
				</div> 
				<h3><a id="panel" href="#">Reporte de Programas</a></h3> 
				<div> 
						<table id="jqGrid"></table>
						<div id="jqGridPager"></div>
				</div> 
			</div> 		  	
				
			</div>
		</div>
	  	@frontend.footer()
	</section>
</div>
@frontend.headerScripts()
<link rel="stylesheet" href="@routes.Assets.at("frontend/jquery-ui-1.11.4/jquery-ui.css")">
<link rel="stylesheet" href="@routes.Assets.at("frontend/jqgrid/css/ui.jqgrid.css")">
<script src="@routes.Assets.at("frontend/jqgrid/js/i18n/grid.locale-es.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("frontend/jqgrid/plugins/jquery.highlight-5.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("frontend/jqgrid/js/jquery.jqGrid.min.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("frontend/highcharts/highcharts.js")"></script>
<script src="@routes.Assets.at("frontend/highcharts/highcharts-more.js")"></script>
<script src="@routes.Assets.at("frontend/highcharts/modules/exporting.js")"></script>
<script type="text/javascript">
$(document).ready(function(){
	var getColumnIndexByName = function (grid, columnName) {
        var cm = grid.jqGrid('getGridParam', 'colModel'), i, l = cm.length;
        for (i = 0; i < l; i += 1) {
            if (cm[i].name === columnName) {
                return i; // return the index
            }
        }
        return -1;
    }
	Highcharts.setOptions({  
        lang: {  
        loading: 'Cargando...',  
        months: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],  
        weekdays: ['Domingo', 'Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes', 'Sábado'],  
        shortMonths: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],  
        exportButtonTitle: "Exportar",  
        printButtonTitle: "Importar",  
        rangeSelectorFrom: "De",  
        rangeSelectorTo: "A",  
        rangeSelectorZoom: "Periodo",  
        downloadPNG: 'Descargar gráfica PNG',  
        downloadJPEG: 'Descargar gráfica JPEG',  
        downloadPDF: 'Descargar gráfica PDF',  
        downloadSVG: 'Descargar gráfica SVG',  
        printChart: 'Imprimir Gráfica',  
        thousandsSep: ",",  
        decimalPoint: '.'  
    }   
	});
	var full = location.protocol+'//'+location.hostname+(location.port ? ':'+location.port: '') + '/program-details/';

	var options = {
		    chart: {
		        renderTo: 'container',
	            type: 'scatter',
	            zoomType: 'xy'
		    },title: {
		    	text: 'CPI/SPI',
	            style: {
	                fontWeight: 'bold'
	            }
	        },tooltip: {
	            formatter: function() {
	                //return '<b><a href="' + full + this.point.z + '"/>' +this.point.programa + '</a></b>';
	                return '<b>' + this.point.programa +'</b>';
	            }
	        },xAxis: {
	            title: {
	                text: 'CPI'
	            },plotLines:[{value:0.75,color: 'red',width:2},{value:0.95,color: 'red',width:2}]
	        },
	        plotOptions: {
	            series: {
	                cursor: 'pointer',
	                events: {
	                    click: function (e) {
	                    	window.location.href = full + e.point.z;
	                        //alert('programa ' + e.point.z);
	                    }
	                }
	            }
	        },
	        yAxis: {
	            title: {
	                text: 'SPI'
	            },plotLines:[{value:0.7,color: 'red',width:2},{value:0.9,color: 'red',width:2}]
	        },
		    series: []
	};


	$( "#accordion" ).accordion({
		collapsible:true,
		active:false,
		navigation:true,
		autoHeight:false,
		change:function(event, ui){
			var currentHeaderID = ui.newHeader.find("a").attr("id");
			//alert(currentHeaderHREF);
			if(currentHeaderID=='burbujas'){
				if($('#container').html() == "") {
					$.ajax({
						  url: '/burbujas',
						  type: 'GET',
						  success: function(data) {
								options.series.push(JSON.parse(data));
								var chart = new Highcharts.Chart(options);
						  },
						  error: function(e) {

						  }
					}); 
				}

			}else if(currentHeaderID=='panel'){
				if($('#jqGrid').html() == "") {
					$("#jqGrid").jqGrid({
				        url: '/panel',
				        mtype: "GET",
				        datatype: "json",
				        page: 1,
				        colModel: [
				            { label: 'División', name: 'division', key: true, width: 300 },
				            { label: 'Programa', name: 'programa', width: 250 },
				            { label: 'Responsable', name: 'responsable', width: 150 },
				            { label: 'Fecha Inicio', name: 'fecini', width: 150 },
				            { label: 'Fecha Comprometida', name: 'feccom', width: 150 },
				            { label: '% Avance', name: 'pai', width: 120 },
				            { label: '% Plan', name: 'pae', width: 100 },
				            { label: 'SPI', name: 'spi', width: 50 },
				            { label: 'CPI', name: 'cpi', width: 50 },
				            { label: 'Inversión', name: 'inversion', width: 150 },  
				            { label: 'Gasto', name: 'gasto', width: 150 }                      
				        ],
						viewrecords: true,
						regional : "es",
				        width: 1050,
				        height: 450,
				        rowNum: 20,
				        pager: "#jqGridPager",
				        grouping: true,
				        loadonce: true,
				        ignoreCase: true,
				        groupingView: {
				            groupField: ['division'],
				            groupColumnShow: [true],
				            groupText: ['<b>{0}</b>'],
				            groupOrder: ['asc'],
				            groupSummary: [false],
				            groupCollapse: false
				        },loadComplete: function () {
		                    var filters, i, l, rules, rule, iCol, $this = $(this);
		                    if (this.p.search === true) {
		                        filters = $.parseJSON(this.p.postData.filters);
		                        if (filters !== null && typeof filters.rules !== 'undefined' &&
		                                filters.rules.length > 0) {
		                            rules = filters.rules;
		                            l = rules.length;
		                            for (i = 0; i < l; i++) {
		                                rule = rules[i];
		                                iCol = getColumnIndexByName($this, rule.field);
		                                if (iCol >=0) {
		                                    $('>tbody>tr.jqgrow>td:nth-child(' + (iCol + 1) +
		                                        ')', this).highlight(rule.data);
		                                }
		                            }
		                        }
		                    }
		                    return;
		                }
						        
				    });	
				
					$("#jqGrid").jqGrid('filterToolbar', {stringResult: true, searchOnEnter: false, defaultSearch: 'cn'});
					$("#jqGrid").jqGrid('navGrid','#jqGridPager',{add:false,edit:false,del:false});
					$("#jqGrid").jqGrid('navButtonAdd','#jqGridPager',{
					       caption:"",
					       title: "Exportar a Excel", 
					       onClickButton : function () { 
					    	   $("#jqGrid").jqGrid('excelExport',{"url":"getExcel"});
					       } 
					});	
				}			
			}
 		}
	});	

	
});


</script>
</body>
</html>