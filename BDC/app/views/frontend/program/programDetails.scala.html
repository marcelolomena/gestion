@(expected_completion_percentage:String,
	completion_percentage_forProgram : String,
	program:Option[ProgramMaster],
	programDetail:Option[ProgramDetails],
	programDates:Option[ProgramDates],
	projectList :Seq[Project],
	 documents : Seq[DocumentMaster],
	  changeSet:String,
	  progrma_members: Seq[ProgramInternalMembers],
	  saps:List[SAP],
	   external_resource: Seq[models.
	   ProgramMembersExternalAllocation],
	   programWorkflowStatus:String,
	   impacto:String)(implicit session: play.api.mvc.Session,lang:Lang,req : play.api.mvc.RequestHeader) 
@frontend.layout()
@import services._
@import utils._
@import play.api.i18n._
@import play.api._
@import java.math.BigInteger; var subTasks: Seq[SubTasks]= null ; var i=1;var pStatus: Option[ProjectStatus] = null;var version: Option[VersionDetails] = null;var versions: Seq[VersionDetails] = null;var user: Option[Users] = null;
@import utils._;var programtypes: Option[ProgramTypeMaster] = ProgramTypeService.findProgramTypeById(program.get.program_type.toString);var subtypes: Option[SubTypes] = null; var genrenciaDetails :Option[Genrencias] =  null;var departmentDetails : Option[Departments]= null;
<link rel="stylesheet" href="@routes.Assets.at("frontend/stylesheets/jquery-ui.css")">
<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="http://www.pureexample.com/js/flot/excanvas.min.js"></script><![endif]-->
<style type="text/css" media="screen">
    th.ui-th-column div{
        white-space:normal !important;
        height:auto !important;
        padding:2px;
    }
    
    /* set the size of the datepicker search control for Order Date*/
    #ui-datepicker-div { font-size:11px; }
        
    /* set the size of the autocomplete search control*/
    .ui-menu-item {
        font-size: 11px;
    }

    .ui-autocomplete {
        font-size: 11px;
    } 
    
    .ui-dialog .ui-dialog-title {
    float: left;
    margin: .1em 16px .1em 0;
    text-align: center;
    width: 100%;
}    
</style>
</head>
<body>
@frontend.topLayout()
<div class="main">
@*@if(UserAuthentication.IsAuthenticatedAdmin(session.get("utype").get)){
	<div class="width_full" id="new-auth" style="border:1px solid red;">hello</div>
}*@
@frontend.header()
<section class="slider" id="program-details">
<input id="program" value="@program.get.program_id" class="display-none"/>
<input id="projectId" value="" class="display-none"/>
<input id="project_id" value="" class="display-none"/>
<input id="projectDetails" value="" class="display-none"/>
<input type="hidden" id="user_profile_id" @if(!session.get("user_profile").isEmpty) {value="@session.get("user_profile").get"}>
<input id="program_changeset" name="program_changeset" value="@changeSet" type="hidden"/>
<div class="product_main">
  <div class="product_detail_1">
  
   	<h3 id="productNm" class="parent-new-h3">
    	<span class="parent-icon"> &#60; </span>
	  	<a href="/programs">
	  		<span class="left"> @Messages("programDetails.proogramlist")</span>
  	  	</a>
  	  	
  	  	@if(ProgramService.permisosPrograma(program.get.program_id.get.toString,session.get("uId").get)==1){
	  	  	<a href="/edit-program/@program.get.program_id" style="float:right;margin-right: 12px;"> 
		 		<span class="edit-project edit-icon edit-text">@Messages("programDetails.edit") </span>
		 	</a>
	 	}
		@*<a href="@controllers.Frontend.routes.Program.exportToExcel(program.get.program_id.get.toString())" class="exportToexcel">
	  		<span > Export to excel </span>
  	  	 </a>*@
   </h3>
   <h3 id="productNm">
	    <a href="javascript:toggleDiv('program-detail');"><span class="left font13px" style="width:930px;   word-wrap: break-word;">@program.get.program_name </span></a>
   </h3>
  <div class="width_full" id="program-detail">
  	
  	<ul style="width: 290px;float:left;  border-right: 1px dashed #666666; min-height:285px;">
  		<li>
  			<div class="width_full" style="margin:5px 0 10px;padding-left: 8px;">
		  <span class="program-desc-label">@Messages("programDetails.description")</span>
		  	
			<span class="program-desc">@program.get.program_description</span>	
		  </div>
		</li>
  	</ul>
  	
  	<ul style="width: 320px;float:left;margin-left: 10px;border-right: 1px dashed #666666;min-height: 285px;">
  		<li>
  			<span class="header">@Messages("addNewProgram.programTypedetail")</span>
  			<span class="program-data">
				@if(!programtypes.isEmpty){
					@programtypes.get.program_type
			  	}
			</span>
		</li>
		
		<li>
			<span class="header">@Messages("programDetails.programSubType")</span>
			<span class="program-data">
				
				@if(!program.get.program_sub_type.isEmpty){
					@{ subtypes = SubTypeService.findSubTypeById(program.get.program_sub_type.get.toString) }
					@if(!subtypes.isEmpty){
						@subtypes.get.sub_type	
					}
			  	}
			 </span>
		</li>

         <li>
			<span class="header">Clasificación </span>
			<span class="program-data">
				@if(!program.get.clasificacion.isEmpty){
					@program.get.clasificacion.get
			  	}
			</span>

		</li>		
		
		<li>
			<span class="header">@Messages("programDetails.demandmanager")</span>
		
			<span class="program-data" style="margin-left:5px;">@if(!UserService.findUserDetailsById(program.get.demand_manager.toLong).isEmpty){ <a href="/employee/@program.get.demand_manager" class="progDemandMgr">@UserService.findUserDetailsById(program.get.demand_manager.toLong).get.first_name&nbsp;@UserService.findUserDetailsById(program.get.demand_manager.toLong).get.last_name</a>}</span>
		</li>
  		<li>
			<span class="header">@Messages("programDetails.division")</span>
			<span class="program-data">@DivisionService.findDivisionById(programDetail.get.devison).get.division</span>
		</li>
		
		<li>
			<span class="header">@Messages("programDetails.gerencia") </span>
			<span class="program-data">
				@if(!programDetail.get.management.isEmpty){
					@{genrenciaDetails = GenrenciaService.findGenrenciaById(programDetail.get.management.get) }
					@if(!genrenciaDetails.isEmpty){
						@genrenciaDetails.get.genrencia
					}
	  					
	  			}	
	  		</span>
		</li>

         <li>
			<span class="header">Estado </span>
			<span class="program-data">
				@programWorkflowStatus
			</span>

		</li>
		
         <li>
			<span class="header">Impacto </span>
			<span class="program-data">
				@impacto
			</span>

		</li>		
  	</ul>
  	<ul style="width: 310px;float:left;margin-left: 10px;  min-height:285px;">
  		
  		<li>
			<span class="header">@Messages("programDetails.initiationdate")</span>
			<span class="program-data" style="width:auto;" id="initial_planned_date">
			@if(programDates.get.initiation_planned_date != null){
				@programDates.get.initiation_planned_date.format("dd-MM-yyyy")
			}
				
			</span>
		</li>
		
		<li>
			<span class="header">@Messages("programDetails.releaseDate")</span>
			<span class="program-data"  id="release_date">
				@if(programDates.get.release_date != null){
					@programDates.get.release_date.format("dd-MM-yyyy")
				}
			</span>
		</li>
				
		<li>
			<span class="header">@Messages("addNewProgram.detailedClosureDate")</span>
			<span class="program-data"  id="closure_date">
				@if(!programDates.get.closure_date.isEmpty){
					@programDates.get.closure_date.get.format("dd-MM-yyyy")
				}else{
				NA
				}
			</span>
		</li>

		<li>
			<span class="header">@Messages("programDetails.ha")</span>
			<span class="program-data" id="planned_hours">
				<span style="float: left;width:73px">
				@if(!program.get.planned_hours.isEmpty){
					<input type="text"  disabled="disabled" value="@program.get.planned_hours.get.toLong" min="0" maxlength="9" readonly="readonly" class="planned_hours" />
					
				}else{
					<input type="text" disabled="disabled" value="0" maxlength="9" min="0" class="planned_hours" readonly="readonly"/>
				}
				</span>
				@if(utils.UserAccess.checkAccess(req,"program_plan_hours")){
					<span class="edit-hours"></span>
				}
			</span>
		</li>
		
		<li>
			<span class="header">@Messages("addNewProgram.estimatedCost")</span>
			<span class="program-data ">
				<span style="float: left;width:73px">
				@if(!program.get.estimated_cost.isEmpty){
					<input type="text"  disabled="disabled" value="@program.get.estimated_cost.get.toLong" maxlength="11"  readonly="readonly" class="estimated_cost_program" />
					
				}else{
					<input type="text" disabled="disabled" value="0" maxlength="11"  class="estimated_cost_program" readonly="readonly"/>
				}
				</span>
					<span class="edit-estimated-cost"></span>
			</span>
		</li>
		<li>
			<span class="header">@Messages("programDetails.programcode")</span>
			<span class="program-data ">
				@if(program.get.program_code.isWhole() ){
					@program.get.program_code
				}
			</span>
		</li>
		
		<li>
			<span class="header">Tamaño</span>
			<span class="program-data ">
				@if(!program.get.internal_state.isEmpty ){
					@program.get.internal_state
				}
			</span>
		</li>		
		
		
  	</ul>
  	</div>
  	
	@if(projectList.size>0 && utils.UserAccess.checkAccess(req,"task_listing")){
				<div class="width_full" id="div_sel_type" >

					<select class="input-xlarge" id="panelcombobox">
						<option value="0">--Seleccione un Panel--</option>
					</select>
					<span class="active edit_paneles" id="m_2321"></span>				
				</div>				
				<h3 id="productNm">
					<a href="javascript:toggleDiv('earn-value-info');"><span class="left">@Messages("programDetails.earnedvalueanalysis")</span></a>
				</h3>
				<div class="width_full" id="earn-value-info"  >
					 <table id="subtask-details">
						<tbody>
						<tr>
							<td class="table_header">@Messages("programDetails.earnedvalue") </td>
							<td class="p_values width160px"><span id="ev"></span> </td>
							<td class="table_header">@Messages("programDetails.scheduleperformanceindex")</td>
							<td class="p_values width160px"><span id="spi"></span></td>
						</tr>
						<tr>
							<td class="table_header">@Messages("programDetails.plannedvalue")  </td>
							<td class="p_values width160px"><span id="pv"></span>  </td>
							<td class="table_header">@Messages("programDetails.costperformanceindex") </td>
							<td class="p_values width160px"><span id="cpi"></span></td>
						</tr>
						<tr>
							<td class="table_header">@Messages("programDetails.actualcost")</td>
							<td class="p_values width160px"><span id="ac"></span></td>
							@if(ProgramService.permisosPrograma(program.get.program_id.get.toString,session.get("uId").get)==1){
							<td class="table_header">@Messages("programDetails.estimatetocomplete")</td>
							<td class="p_values width160px"><span id="etc"></span></td>
							}		
												
						</tr>
						<tr>
							<td class="table_header">@Messages("programDetails.ha")</td>
							<td class="p_values width160px"><span id="ha"></span></td>		
							@if(ProgramService.permisosPrograma(program.get.program_id.get.toString,session.get("uId").get)==1){				
							<td class="table_header">@Messages("programDetails.estimetcopmletion")</td>
							<td class="p_values width160px"><span id="eac"></span></td>
							}
						</tr>
						<tr>
							<td class="table_header">@Messages("programDetails.scheduledvar")</td>
							<td class="p_values width160px"><span id="pai"></span></td>		
							<td class="table_header">&nbsp;</td>
							<td class="p_values width160px">&nbsp;</span></td>											
						</tr>
						<tr>
							<td class="table_header">@Messages("programDetails.pae")</td>
							<td class="p_values width160px"><span id="pae"></span></td>
							<td class="table_header">@Messages("programDetails.hp")</td>
							<td class="p_values width160px"><span id="hp"></span></td>
						</tr>
						</tbody>
					</table>
	  			</div>
	  			
	  			
	  			<h3 id="productNm">
					<a href="javascript:toggleDiv('earn-value-info');"><span class="left">Análisis del Valor Ganado Proporcional</span></a>
				</h3>
				<div class="width_full" id="earn-value-info"  >
					 <table id="subtask-details">
						<tbody>
						<tr>
							<td class="table_header">@Messages("programDetails.plannedvalue")  </td>
							<td class="p_values width160px"><span id="pv2"></span></td>
							<td class="table_header">@Messages("programDetails.scheduleperformanceindex")</td>
							<td class="p_values width160px"><span id="spi2"></span></td>
						</tr>
						<tr>
							<td class="table_header">@Messages("programDetails.pae")</td>
							<td class="p_values width160px"><span id="pae2"></span></td>
						</tr>
						<!--  RRM: Agrega dos filas nuevas -->
						<tr>
							<td class="table_header">@Messages("programDetails.agi")</td>
							<td class="p_values width160px"><span id="agi"></span></td>
						</tr>	
						<tr>
							<td class="table_header">@Messages("programDetails.age")</td>
							<td class="p_values width160px"><span id="age"></span></td>
						</tr>							
						</tbody>
					</table>
	  			</div>
 		  }  	
  	<h3 id="productNm">
		<a href="javascript:toggleDiv('mstatus');"><span class="left">Lista de Estados</span></a>
	</h3>
	<div class="width_full" id="mstatus">
				@frontend.program.statusListprogram(program.get.program_id.get.toString())
	</div>	
  	
  	<h3 id="productNm">
		<a href="javascript:toggleDiv('trisk');"><span class="left">@Messages("subtaskdetail.programrisk")</span></a>
	</h3>
 	<div class="program-div" id="new-risk">
 		<span><a href="@controllers.Frontend.routes.Risks.addRisk(program.get.program_id.get.toString,riskParentType.Program.id)"> @Messages("programdetails.addrisk")</a></span>
	</div>
	<div class="width_full" id="trisk">
		@frontend.risks.riskListingProgram(program.get.program_id.get.toString(),riskParentType.Program.id)
	</div>
	
@if(RiskService.countRiskForShow(program.get.program_id.get.toString)>0){
  	<h3 id="productNm">
		<a href="javascript:toggleDiv('mrisk');"><span class="left">Matriz de Riesgo</span></a>
	</h3>	
	
	<div class="width_full" id="mrisk">
				<div class="panel panel-primary">
					<div>
						<h4 style="text-align: center;">Probabilidad</h4>
					</div>
					<div class="table-responsive">
						<table width="98%">
							<tr>
								<td width="10%">
									<div class="vertical-text">
										<h4>Impacto</h4>
									</div>
								</td>
								<td width="90%">
									<table class="table table-bordered">
										<thead>
											<tr>
												<th width="15%"></th>
												<th width="17%" style="text-align: center">Bajo</th>
												<th width="17%" style="text-align: center">Medio</th>
												<th width="17%" style="text-align: center">Alto</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td align="center">Alto</td>
												<td align="center" bgcolor="yellow">@RiskService.countRisk(program.get.program_id.get.toString,0,2)</td>
												<td align="center" bgcolor="red">@RiskService.countRisk(program.get.program_id.get.toString,1,2)</td>
												<td align="center" bgcolor="red">@RiskService.countRisk(program.get.program_id.get.toString,2,2)</td>
											</tr>
											<tr>
												<td align="center">Medio</td>
												<td align="center" bgcolor="green">@RiskService.countRisk(program.get.program_id.get.toString,0,1)</td>
												<td align="center" bgcolor="yellow">@RiskService.countRisk(program.get.program_id.get.toString,1,1)</td>
												<td align="center" bgcolor="red">@RiskService.countRisk(program.get.program_id.get.toString,2,1)</td>
											</tr>
											<tr>
												<td align="center">Bajo</td>
												<td align="center" bgcolor="green">@RiskService.countRisk(program.get.program_id.get.toString,0,0)</td>
												<td align="center" bgcolor="green">@RiskService.countRisk(program.get.program_id.get.toString,1,0)</td>
												<td align="center" bgcolor="yellow">@RiskService.countRisk(program.get.program_id.get.toString,2,0)</td>
											</tr>
										</tbody>
									</table>
								</td>
							</tr>
						</table>
					</div>

				</div>

	</div>	
}
	@if(utils.UserAccess.checkAccess(req,"program_member_listing")){
		<h3 id="productNm">
			    <a href="javascript:toggleDiv('program_member_list');"><span class="left">@Messages("programdetails.programmembers")</span></a>
		</h3>
		
		@if(utils.UserAccess.checkAccess(req,"program_member_add")){
	   		<div class="program-div" id="new-program-member">
	   			<span><a href="@controllers.Frontend.routes.Program.newMembers(program.get.program_id.get.toString)">  @Messages("programdetails.newmember")</a></span>
			</div>
		}
		
			<div class="width_full" id="program_member_list" >
				<ul id="member_list">
					<li class="top-header">
						<span class="role header" style="margin-left: 13px;">@Messages("newmember.role")</span>
						<span class="member header">@Messages("booktime.provider")</span>
						<span class="provider header">@Messages("newmember.member")</span>
						<span class="asignacion header">Horas Asignadas</span>
						<span class="asignacion header">EV</span>
						<span class="asignacion header">PV</span>
						<span class="consumo header">Horas Consumidas</span>
						<span class="diferencia header">Diferencia Horas</span>
						<span class="active header">@Messages("newmember.action")</span>
					</li>
					@if(progrma_members.size>0){
						@for( (p,index) <- progrma_members.zipWithIndex){
							@if(p.hours!=0){
							<a href="/program-distribucion-interno?id=@p.member_id&pid=@p.program_id" class="interno" id="h_@p.member_id"><li class="@if(index%2==0){even_row}else{odd_row}">	
								@if(UserRoleService.findUserRoleById(p.role_id.toString).isEmpty){
									<span id="r_@p.id" class="role @if(p.is_active==0){active-sap}else{in-active-sap}" >&nbsp</span>
								}else{
									<span id="r_@p.id" class="role @if(p.is_active==0){active-sap}else{in-active-sap}" >@UserRoleService.findUserRoleById(p.role_id.toString).get.role </span>
								}
								<span class="member">BCH</span>
								<span class="provider">@UserService.findUserDetails(p.member_id).get.first_name&nbsp;@UserService.findUserDetails(p.member_id).get.last_name</span>
								<span class="asignacion">@p.estimated_time</span>
								<span class="asignacion">@p.ev</span>
								<span class="asignacion">@p.pv</span>
								<span class="consumo">@p.hours</span>
								<span class="diferencia">@p.diferencia</span></a>
								@if(utils.UserAccess.checkAccess(req,"program_member_delete")){
									<span class="active member-action @if(p.is_active==0){enabled_member}else{disabled_member}" id="m_@p.id"></span>
								}
								@if(utils.UserAccess.checkAccess(req,"program_member_delete")){
									<span class="active @if(p.is_active==0){edit_member}else{edit_member}" id="m_@p.id"></span>
								}								
							</li> 
							}else{
							<li class="@if(index%2==0){even_row}else{odd_row}">	
								@if(UserRoleService.findUserRoleById(p.role_id.toString).isEmpty){
									<span id="r_@p.id" class="role @if(p.is_active==0){active-sap}else{in-active-sap}">&nbsp</span>
								}else{
									<span id="r_@p.id" class="role @if(p.is_active==0){active-sap}else{in-active-sap}">@UserRoleService.findUserRoleById(p.role_id.toString).get.role </span>
								}
								<span class="member">BCH</span>
								<span class="provider">@UserService.findUserDetails(p.member_id).get.first_name&nbsp;@UserService.findUserDetails(p.member_id).get.last_name</span>
								<span class="asignacion">@p.estimated_time</span>
								<span class="asignacion">@p.ev</span>
								<span class="asignacion">@p.pv</span>
								<span class="consumo">@p.hours</span>
								<span class="diferencia">@p.diferencia</span>
								@if(utils.UserAccess.checkAccess(req,"program_member_delete")){
									<span class="active member-action @if(p.is_active==0){enabled_member}else{disabled_member}" id="m_@p.id"></span>
								}
								@if(utils.UserAccess.checkAccess(req,"program_member_delete")){
									<span class="active @if(p.is_active==0){edit_member}else{edit_member}" id="m_@p.id"></span>
								}								
							</li> 							
							}
						}
					}else{
						<span class="no-member">@Messages("programDetails.nomemeber")</span>
					}
					@if(external_resource.size > 0){
						@for( (e,index) <- external_resource.zipWithIndex){
							@if(e.hours!=0){
							<a href="/program-distribucion-externo?id=@e.id&pid=@e.program_id" class="externo" id="h_@e.id"><li class="@if(index%2==0){even_row}else{odd_row}">	
								@if(UserRoleService.findUserRoleById(e.provider_type.toString).isEmpty){
									<span id="r_@e.id" class="role @if(e.is_deleted==0){active-sap}else{in-active-sap}" >&nbsp</span>
								}else{
									<span id="r_@e.id" class="role @if(e.is_deleted==0){active-sap}else{in-active-sap}" >@UserRoleService.findUserRoleById(e.provider_type.toString).get.role </span>
								}
								<span class="member">@e.provider_name.toString()</span>
								@if(!e.provider_name.isEmpty()){
									<span class="provider">	
									@if(e.provider_type == 46){
										@e.resource_name &nbsp;	
									}else{
										@if(!e.number_of_resources.isEmpty){
											@e.number_of_resources.get	
										}else{
											@Messages("booktime.externalresource")
										}
										
									}
									</span>
								}else{
									<span class="provider">@Messages("booktime.externalresource")</span>
								}
								<span class="asignacion">@e.estimated_time</span>
								<span class="asignacion">@e.ev</span>
								<span class="asignacion">@e.pv</span>
								<span class="consumo">@e.hours</span>
								<span class="diferencia">@e.diferencia</span></a>
								<span class="active member-action-external @if(e.is_deleted==0){enabled_member}else{disabled_member}" id="m_@e.id"></span>
							</li>
							}else{
							<li class="@if(index%2==0){even_row}else{odd_row}">	
								@if(UserRoleService.findUserRoleById(e.provider_type.toString).isEmpty){
									<span id="r_@e.id" class="role @if(e.is_deleted==0){active-sap}else{in-active-sap}" >&nbsp</span>
								}else{
									<span id="r_@e.id" class="role @if(e.is_deleted==0){active-sap}else{in-active-sap}" >@UserRoleService.findUserRoleById(e.provider_type.toString).get.role </span>
								}
								<span class="member">@e.provider_name.toString()</span>
								@if(!e.provider_name.isEmpty()){
									<span class="provider">	
									@if(e.provider_type == 46){
										@e.resource_name &nbsp;	
									}else{
										@if(!e.number_of_resources.isEmpty){
											@e.number_of_resources.get	
										}else{
											@Messages("booktime.externalresource")
										}
										
									}
									</span>
								}else{
									<span class="provider">@Messages("booktime.externalresource")</span>
								}
								<span class="asignacion">@e.estimated_time</span>
								<span class="asignacion">@e.ev</span>
								<span class="asignacion">@e.pv</span>
								<span class="consumo">@e.hours</span>
								<span class="diferencia">@e.diferencia</span>
								<span class="active member-action-external @if(e.is_deleted==0){enabled_member}else{disabled_member}" id="m_@e.id"></span>
							</li>							
							}
						}
					}
				</ul>
			</div>
		}
		@if(utils.UserAccess.checkAccess(req,"program_sap_listing")){
			<h3 id="productNm">
			    <a href="javascript:toggleDiv('sap_listing');"><span class="left"> @Messages("projectdetails.projectSAPlisting")</span></a>
		   	</h3>
		   	@if(utils.UserAccess.checkAccess(req,"program_sap_add")){
			   	<div class="program-div" id="new-program-sap">
			   		<span><a href="@controllers.Frontend.routes.Program.newSAP(program.get.program_id.get.toString)">@Messages("programdetails.addsap")</a></span>
				</div>
			}
			
			<div class="width_full" id="sap_listing">
			@if(saps.size>0){
				<ul id="sap_list">
					<li class="top-header height28px">
						<span class="role header" style="width:83px"> @Messages("programDetails.sapcode")</span>
						<span class="member header">@Messages("programdetails.sapdetails.investment")</span>
						<span class="member header">@Messages("programdetails.sapdetails.expenditure")</span>
						<span class="member header">Presupuesto Total</span>
						<span class="member header">Fecha Aprobación</span>
						<span class="member header">Fecha Paso a Prod.</span>
						<span class="member header">Fecha Cierre</span>
						<span class="active header">@Messages("programDetails.action")</span>
					</li>
					@for( (p,index) <- saps.zipWithIndex){
					<li class="@if(index%2==0){even_row}else{odd_row} @p.id.toString">	
						<span id="p_s_@p.id" class="role  @if(p.is_active==1){active-sap}else{in-active-sap}">@p.sap_number</span>
						<span class="member">@FormattedOutPuts.formattedvalue(SAPServices.calculateSAPInvestment(p.id.toString))</span>
						<span class="member">@FormattedOutPuts.formattedvalue(SAPServices.calculateSAPExpenditure(p.id.toString))</span>
						<span class="member">@FormattedOutPuts.formattedvalue((SAPServices.calculateSAPInvestment(p.id.toString)+SAPServices.calculateSAPExpenditure(p.id.toString))) </span>
						<span class="member">@if(p.approved_date){
						@p.approved_date.get.format("dd/MM/YYYY")}&nbsp;</span>
						<span class="member">@if(p.approved_date){
						@p.comitted_date.get.format("dd/MM/YYYY")}&nbsp;</span>
						<span class="member">@if(p.close_date){
						@p.close_date.get.format("dd/MM/YYYY")}&nbsp;</span>
						@if(utils.UserAccess.checkAccess(req,"program_sap_update")){
							<a href="@controllers.Frontend.routes.Program.editSAP(p.id.toString)"><span class="active edit-icon" id="m_@p.id"></span></a>
						}
						@if(utils.UserAccess.checkAccess(req,"program_sap_delete")){
							<span class="active-sap program-sap @if(p.is_active==0){sap-enabled}else{sap-disabled}" id="sap_@p.id" style="margin-left: 5px"></span>
						}
					</li>
					}
				
				</ul>
			}else{
					<span class="no-member"> @Messages("programDetails.nosap")</span>
			}
		</div>
	}
		
	@if(utils.UserAccess.checkAccess(req,"project_listing")){
	 	<h3 id="productNm">
		   <span class="left">@Messages("programDetails.projects")</span>
	    </h3>
	    
	    @if(utils.UserAccess.checkAccess(req,"project_add")){
		    <div class="program-div" id="new-program">
		   		<span><a href="/add-new-project/@program.get.program_id">@Messages("programDetails.newproject") </a></span>
			</div>
		}
	  	<!-- Project Listing  -->
		 	@if(projectList.size>0){
			<div class="project_list">
			  <h3 class="title" style="width: 98.2%">
			  	<span>@Messages("programDetails.nameofproject")</span>
				<span style="margin-left: 385px;">@Messages("programDetails.duration")</span>
				<span style="margin-left: 142px;">@Messages("programDetails.task") </span>
				<span style="margin-left: 30px;">@Messages("addDepartment.projectworkflowstatus")</span>
				<span style="margin-left: 40px;">@Messages("programDetails.action") </span> 
			  </h3>
			  	<div class="project_list_1  padding-none">
			    	<div class="design_team_left_detail_1_left " id="container">
			   		    @for(p <- ProjectService.findProjectListForProgram(programDetail.get.program_id.toString())){
					    		<div class="project_list_1">
					    			<a href="/project-details/@p.pId" class="left">
					        		<p class="left show-project-details" id="pr_@p.pId.get"> @p.project_name  </p>
					        		<span class="display-none" id="show_pr_@p.pId.get">@p.project_name </span>
					        		<span class="design_team_span " style="margin-left:48px">@p.start_date.format("dd-MM-yyyy") &nbsp;To&nbsp;@p.final_release_date.format("dd-MM-yyyy")</span>
				        			<span class="design_team_span " style="width:80px;margin-left:100px">@TaskService.findProjectTaskCount(p.pId.get.toString)</span>
				        			</a>
				        			
				        			@{
				        				pStatus= ProjectService.findProjectStatus(p.pId.get.toString())
				        				if(!pStatus.isEmpty){
				        						pStatus.get.status match{
				        								case 0 => <span class='status_0 status-change'></span>	
														case 1 => <span class='status_1 status-change'></span>	
														case 2 => <span class='status_2 status-change'></span>
				        						}
				        				}else{
				        				<span class='status_0 status-change'></span>
				        				}
				        			
				        			}
				        			@if(utils.UserAccess.checkAccess(req,"project_delete")){
					        			<span class="left">
				              				<span class="delete_icon-project" id="m_@p.pId"></span>
					            		</span>
				            		}
					      		</div>
				      	}
			    </div>
			    </div>
			 </div>
			
		 }
	 }
	 
	 <!--<div class="width_full">-->
	     	@if(projectList.size!=0 && utils.UserAccess.checkAccess(req,"project_gantt")){
     			<!--<div class="width_full">-->
				    <h3 class="header-background" id="task-gantt-label">
					<a href="javascript:toggleDiv('project-gantt');"><span class="left" style="padding: 5px;">@Messages("programdetails.ganttchartview")</span></a>
				    </h3>
				<!--</div>-->
				<div class="width_full" id="project-gantt">
				</div>
			}
      <!--</div>-->
    
    @if(projectList.size!=0 && utils.UserAccess.checkAccess(req,"project_gantt")){
	  	 <h3 id="productNm">
		    <a href="javascript:toggleDiv('earn-value');"><span class="left"> @Messages("programDetails.earnedvalueanalysis")  </span></a>
		 </h3>
		<div class="width_full" id="earn-value">
		    <div id="container_id" style="height: 300px;"> </div>
		    <div id="container_2" style="height: 300px;"> </div>
		    <div id="container_3" style="height: 300px;"> </div>
		</div>
	}else{
		 <div class="width_full" id="earn-value" style="display: none;">
	          <div id="container_id" style="height: 300px;"></div>
	 		  <div id="container_2" style="height: 300px;"></div>
	 		  <div id="container_3" style="height: 300px;"></div>
		 </div>
	 	 <div class="project_list project-list-none">
			<p>@Messages("programDetails.noprojectsavailable") </p>
		</div>
	}
		
	<h3 id="productNm">
	    <a href="javascript:toggleDiv('program-subtask-summary');"><span class="left">Sub Resumen de tareas</span></a>
   	</h3>	
	<div class="width_full" id="program-subtask-summary">
	@{subTasks = SubTaskServices.findAllSubTasksForProgram(program.get.program_id.get.toString)}
	
	@frontend.program.programSubTaskSummary(subTasks)
	<ul id="sub_task_items"></ul>
	</div>
		
	<h3 class="header-background" style="margin-top: 30px;">
	    <span class="left">@Messages("uploaddocument.documents")</span>
   	</h3>
	
	@if(utils.UserAccess.checkAccess(req,"upload_program_document")){
		<div class="program-div" id="new-program">
		 	<span><a href='@controllers.Frontend.routes.Documents.uploadDocument(program.get.program_id.get.toString, "PROGRAM", "ADD")'> @Messages("uploaddocument.uploaddocument")</a></span>
		</div>
		
		<div id="docuement-overview">
					<div class="document-left">
						<h3 style="width:99%;font-size:14px;height:26px;padding-left: 5px;"> @Messages("uploaddocument.program")</h3>
							<div id="pro_@program.get.program_id"  class="data-row-even">
								<span class="left program_icon"></span><span class="left program_title">@program.get.program_name</span>
							</div>
							<div id="p_pr_@program.get.program_id" class="">
								@for( (pr, pIndex) <- projectList.zipWithIndex ){
									<div  id="pr_@pr.pId.get" class="project-list @if( pIndex%2==0 ){ project-data-row-even }else{ project-data-row-odd }">
									<span class="left project_icon"></span><span class="left project_title">@pr.project_name</span>
									
									</div>
									<div id="t_@pr.pId.get" class="display-none">
										@for( (task, tIndex ) <- TaskService.findTaskListByProjectId(pr.pId.get.toString).zipWithIndex){
											<div  id="ts_@task.tId.get" class="task_list @if( tIndex%2==0 ){ task-data-row-even }else{ task-data-row-odd }">
											<span class="left task_icon"></span><span class="left task_title">@task.task_title</span>
												
												
											</div>
											<div id="s_@task.tId.get" class=" display-none">
											
													@for( (subtask, sIndex) <- SubTaskServices.findSubTasksByTask(task.tId.get.toString).zipWithIndex ){
															<div  id="st_@subtask.sub_task_id.get" class=" sub_task_list @if( sIndex%2==0 ){ data-row-even }else{ data-row-odd }">
																<span class="left sub_task_icon"></span><span class="left sub_task_title">@subtask.task</span>
															</div>
													}
											</div>
										}
									</div>
								}
							</div>
					</div >
					<div  class="document-right">
						<div class="doc_listing">
							@if(documents.size > 0){	
								<h2 class="push-top20px"> @Messages("uploaddocument.currentdocuments")</h2>
								<div id="current_documents">
									<ul class="width_full">
										<li>
											<span class="doc_title bold">@Messages("uploaddocument.documenttitle")</span> 
											<span class="doc_version bold"> @Messages("uploaddocument.version")</span>
											<span class="doc_date bold">@Messages("uploaddocument.dateofupload")</span> 
											<span class="doc_user bold">  @Messages("uploaddocument.uploadedby")</span> 
											<span class="doc_action bold"> @Messages("uploaddocument.action")</span>
										</li>
										@for((doc, index) <- documents.zipWithIndex){
											@{version = DocumentService.findAllCurrentVersions(doc.Id.get.toString())}
											@{user = UserService.findUserDetailsById(version.get.user_id.toLong)}
												
											<li class="@if( index%2==0 ){ search-result-datarow-even current-doc-listing}else{ search-result-datarow-odd current-doc-listing}">
												<span class="doc_title">@doc.title</span> 
												<span class="doc_version">@version.get.version_alias</span>
												<span class="doc_date"> @version.get.creation_date.format("dd/MM/YYYY")</span> 
												<span class="doc_user">@user.get.first_name&nbsp;@user.get.last_name </span>
												<span class="doc_action"> 
													<span class="doc_info" title="@version.get.version_notes"></span>
													<a href='/documents/@version.get.file_name' target='_blank'><span class="doc_view" title="Click to download the document."></span></a>
													<a href='@controllers.Frontend.routes.Documents.uploadDocument(doc.Id.get.toString(), "PROGRAM", "UPDATE")'><span class="doc_edit" title="Click to uplaod the new version of the document."></span> </a>
													<a href='@controllers.Frontend.routes.Documents.documentDelete(doc.Id.get.toString())' id="Programa_@doc.Id.toString()" class="delete-doc @doc.Id.toString()"><span class="doc-delete" title="Delete Document"></span></a>
												</span>
											</li>
										}
									</ul>
								</div>
							
								<h2 class="left push-top20px">@Messages("uploaddocument.previousdocuments")</h2>
								<div id="previous_documents">
									<ul class="width_full">
										<li>
											<span class="doc_title bold">  @Messages("uploaddocument.documenttitle")</span> 
											<span class="doc_version bold"> @Messages("uploaddocument.version")</span>
											<span class="doc_date bold">    @Messages("uploaddocument.dateofupload")</span> 
											<span class="doc_user bold">  @Messages("uploaddocument.uploadedby")</span> 
											<span class="doc_action bold"> @Messages("uploaddocument.action")</span>
										</li>
										@for(doc <- documents){
											@{ versions = DocumentService.findAllPreviousVersionDocuments(doc.Id.get.toString())}	
											@if(!versions.isEmpty){
												@for(ver <- versions){
													@{user = UserService.findUserDetailsById(ver.user_id.toLong)}
													@{i = i+1}
													<li class="@if( i%2==0 ){ search-result-datarow-even prev-doc-listing prev-doc-listing-@doc.Id.get.toString()}else{ search-result-datarow-odd prev-doc-listing prev-doc-listing-@doc.Id.get.toString()}">
														<span class="doc_title">@doc.title</span>
														<span class="doc_version">@ver.version_alias</span> 
														<span class="doc_date"> @ver.creation_date.format("dd/MM/YYYY")</span> 
														<span class="doc_user">@user.get.first_name </span>
														<span class="doc_action"> 
															<span class="doc_info" title="@ver.version_notes"></span>
															<a href='/documents/@ver.file_name' target='_blank'><span class="doc_view" title="Click to download the document"></span></a>
															<a href='@controllers.Frontend.routes.Documents.uploadDocument(doc.Id.get.toString(), "PROGRAM", "UPDATE")' class="update-doc display-none"><span class="doc_edit" title="Click to uplaod the new version of the document."></span> </a>
															<a href='@controllers.Frontend.routes.Documents.documentDelete(doc.Id.get.toString())' class="delete-doc @doc.Id.toString() display-none"><span class="doc-delete" title="Delete Document"></span></a>
														</span>
													</li>
												}
											}
										}
									</ul>
								</div>
						}else {
							<h2 class="left push-top20px no-document">@Messages("uploaddocument.nodocumentavailable")</h2>
						}
					</div>
	 			</div>
		</div>
  	}

  </div>
 </div>
    @frontend.footer()
    <div class="loader"><img src="@routes.Assets.at("frontend/images/loading.gif")" alt="" /></div>
  </section>
   <div id="dialog-confirm"></div> 
  	<div id="pop-box-over" class="display-none"> 
  	</div>
   
	<div id="dialog-box" class="product-detail-dialog" style="width:190px;"><span class="dialog-close"></span><div class="dialog-content">
	</div>
	</div>
	<div class="tooltip"></div>	
	<div id="distribution"></div>
<div id="dialog-edit-member-capacity"><table id="scroll38"></table><div id="jqGridPager"></div></div>
<div id="dialog-edit-panel"><table id="scroll39"></table><div id="jqGridPager2"></div></div>
</div>	 
@frontend.headerScripts()	
<script src="@routes.Assets.at("frontend/highcharts/highcharts.js")"></script>
<script src="@routes.Assets.at("frontend/highcharts/highcharts-more.js")"></script>
<script src="@routes.Assets.at("frontend/highcharts/modules/exporting.js")"></script>
<script type="text/javascript" src="@routes.Assets.at("frontend/js/main.js")"></script>
<link rel="stylesheet" href="@routes.Assets.at("frontend/jquery-ui-1.12.1/jquery-ui.css")">
<link rel="stylesheet" href="@routes.Assets.at("frontend/jqgrid/css/ui.jqgrid.css")">
<script src="@routes.Assets.at("frontend/jqgrid/js/i18n/grid.locale-es.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("frontend/jqgrid/js/jquery.jqGrid.min.js")" type="text/javascript"></script>
<link rel="stylesheet" href="@routes.Assets.at("frontend/stylesheets/documents.css")">
<script src="@routes.Assets.at("frontend/js/documents.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("frontend/js/jquery.mask.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("frontend/js/jquery.simplePagination.js")" type="text/javascript"></script>
<link rel="stylesheet" href="@routes.Assets.at("frontend/stylesheets/matrix.css")">
<script type="text/javascript">
	function toggleDiv(divId) {
	   $("#"+divId).toggle();
	}
	function validatePositive(value, column) {
		if ( isNaN(value) && value < 0)
			return [false, "Por favor ingrese un valor positivo."];
        else
            return [true, ""];
    }

	$(document).ready( function() {
		console.log("Aloha");
		function editProgramMember() {
			var _this = $(this);
			var mid = _this.attr("id").split("_")[1];
			var purl = "/member_capacity/"  + mid;

			$("#scroll38").jqGrid().setGridParam({url : purl}).trigger("reloadGrid")

			$.get("/name-member-user/" + mid, function(res){
   				$("#dialog-edit-member-capacity").dialog({title:res}).dialog("open");
			});
			$("#scroll38").parents('div.ui-jqgrid-bdiv').css("max-height","400px");		
		}
		
		function editPaneles() {
			var _this = $(this);
			var mid = $("#program").val();
			var purl = "/get-program-panels-edit/"+ mid

			$("#scroll39").jqGrid().setGridParam({url : purl}).trigger("reloadGrid")
			var res = 'Mantenedor Paneles';
   			$("#dialog-edit-panel").dialog({title:res}).dialog("open");
			$("#scroll39").parents('div.ui-jqgrid-bdiv').css("max-height","600px");		
		}

		var jsonOptions = {
				type :"POST",
				contentType :"application/json; charset=utf-8",
				dataType :"json"
		};

		function createJSON(postdata) {
			if (postdata.id === '_empty')
				postdata.id = null;
			return JSON.stringify(postdata)
		}
		
		$("#scroll38").jqGrid({
					url: "",
				    mtype: "GET",
				    datatype: "json",
			        colModel: [
			            { label: 'id', name: 'id', hidden:true,key: true, editable: false,width: 10 },
			            { label: 'Periodo', name: 'periodo', editable: false,width: 100,formatter: 'date',formatoptions: { srcformat: 'U/1000', newformat: 'M,Y' } },
			            { label: 'Porcentaje', name: 'porcentaje', editable: true,editrules:{custom_func:validatePositive,custom: true,required: true},width: 100 }, 
			            { label: 'Porcentaje Otros Programas', name: 'total', editable: false,width: 100}
			        ],
			        pager: "#jqGridPager",
					height:"auto",
					viewrecords: true,
					regional : "es",
			        loadonce: false,
			        page:1,
			        shrinkToFit: false,
					rowList: [],        // disable page size dropdown
    				pgbuttons: false,     // disable page control like next, back button
    				pgtext: null,         // disable pager text like 'Page 0 of 10'
    				viewrecords: false,    // disable current view record text like 'View 1-10 of 100' 
            		editurl: "/update-member_capacity"
			});		
			$("#scroll38").navGrid('#jqGridPager',
			                { edit: true, add: false, del: false, search: false, refresh: false, view: false, position: "left", cloneToTop: false },
			                {   editCaption: "",
			                    recreateForm: true,
			                    mtype:"GET",
								checkOnUpdate : true,
								checkOnSubmit : true,
			                    closeAfterEdit: true,
			                    reloadAfterSubmit: true,
			                    errorTextFormat: function (data) {
			                        return 'Error: ' + data.responseText
			                    }
			                }
			);	
			
		$("#scroll39").jqGrid({
					url: "",
				    mtype: "GET",
				    datatype: "json",
			        colModel: [
			            { label: 'id', name: 'id', hidden:true,key: true, editable: false,width: 10 },
			            { label: ' ', name: 'id_program', hidden:true, editable: true,width: 100 },
			            { label: 'Panel', name: 'name', editable: true,width: 150 },
			            { label: 'Descripción', name: 'description', editable: true,width: 300 }

			        ],
			        pager: "#jqGridPager2",
					height:"auto",
					viewrecords: true,
					regional : "es",
			        loadonce: false,
			        page:1,
			        shrinkToFit: false,
					rowList: [],        // disable page size dropdown
    				pgbuttons: false,     // disable page control like next, back button
    				pgtext: null,         // disable pager text like 'Page 0 of 10'
    				viewrecords: false,    // disable current view record text like 'View 1-10 of 100' 
            		editurl: "/edit-program-panel",
					subGrid: true,
					subGridRowExpanded:showGridProyectos
			});		
			$("#scroll39").navGrid('#jqGridPager2',
			                { edit: true, add: true, del: true, search: false, refresh: false, view: false, position: "left", cloneToTop: false },
			                {   editCaption: "",
			                    mtype: 'POST',
			                    recreateForm: true,
								checkOnUpdate : true,
								checkOnSubmit : true,
			                    closeAfterEdit: true,
			                    reloadAfterSubmit: true,
								ajaxEditOptions: jsonOptions,
								serializeEditData: createJSON,
			                    errorTextFormat: function (data) {
			                        return 'Error: ' + data.responseText
			                    },
								afterSubmit : function(response,postdata){
									var json   = response.responseText;
									var result = JSON.parse(json);
									if(result.error_code!=0)
										return [false,result.error_text,""];
									else
										return [true,"",""]
								}, beforeSubmit : function (postdata, formid) {
									if ( $.trim(postdata.name) == '') {
										return [false,"Completar nombre de panel",""];
									} if( $.trim(postdata.description) == '') {//.length
										return [false,"Completar descripción de panel",""];
									} else {
										return [true,"",""]
									}
								}, beforeShowForm: function(form) {
									$('#id_program',form).val($("#program").val());
									$('#id_program',form).hide();
								}
			                },
							{
							  	addCaption: "Agregar Panel",
							  	mtype: 'POST',
								height: 'auto',
								width: 'auto',
								modal: true,
								ajaxEditOptions: jsonOptions,
								serializeEditData: createJSON,
								closeAfterAdd: true,
								recreateForm: true,
			                    errorTextFormat: function (data) {
			                        return 'Error: ' + data.responseText
			                    },
								afterSubmit : function(response,postdata){
									var json   = response.responseText;
									var result = JSON.parse(json);
									if(result.error_code!=0)
										return [false,result.error_text,""];
									else
										return [true,"",""]
								}, beforeSubmit : function (postdata, formid) {
									if ( $.trim(postdata.name) == '') {
										return [false,"Completar nombre de panel",""];
									} if( $.trim(postdata.description) == '') {//.length
										return [false,"Completar descripción de panel",""];
									} else {
										return [true,"",""]
									}
								}, beforeShowForm: function(form) {
									$('#id_program',form).val($("#program").val());
									$('#id_program',form).hide();
								}
							},
							{
								mtype: 'GET',
								height: 'auto',
								url: '/panelDelete',
								width: 'auto',
								errorTextFormat: function (data) {
									return 'Error: ' + data.responseText
								}
							}
			);

		function showGridProyectos(parentRowID, parentRowKey) {
			var childGridID = parentRowID + "_table";
			var childGridPagerID = parentRowID + "_pager";
			var childGridURL = "/listProjectsPanel/" + parentRowKey;
			var rowData = $("#grid").getRowData(parentRowKey);
			var panel = rowData.id;
			var projectsURL =  '/get-panel-projects/'+$("#program").val()+'/'+parentRowKey;

            var tmplServ = "<div id='responsive-form' class='clearfix'>";

            tmplServ += "<div class='form-row'>";
            tmplServ += "<div class='column-full'><span style='color:red'>*</span>Proyecto {id_project}</div>";
            tmplServ += "</div>";

            tmplServ += "<div class='form-row' style='display: none;'>";
            tmplServ += "<div class='column-full'></span>Panel {id_panel}</div>";
            tmplServ += "</div>";

            tmplServ += "<hr style='width:100%;'/>";
            tmplServ += "<div> {sData} {cData}  </div>";
            tmplServ += "</div>";

			$('#' + parentRowID).append('<table id=' + childGridID + '></table><div id=' + childGridPagerID + ' class=scroll></div>');

			$("#" + childGridID).jqGrid({
				url: childGridURL,
				mtype: "GET",
				datatype: "json",
				colModel: [
					{ label: 'id', name: 'id', hidden:true,key: true, editable: false,width: 10 },
					{ label: ' ', name: 'id_panel', editable: true,width: 100, hidden: true },
					{ label: 'Proyecto', name: 'project', width: 100, align: 'left', search: true,sortable: false, editable: true,
                        editrules: { edithidden: false }, hidedlg: true },
					{ label: 'Id Projecto', name: 'id_project', editable: true,width: 150,hidden:true,
						edittype: "select",
						editoptions: {
							dataUrl: projectsURL,
							buildSelect: function (response) {
								//var data = JSON.parse(response);
								console.log(response);
								var s = "<select>";
								s +=  response;
								return s + "</select>";
							}
						}, dataInit: function (elem) { $(elem).width(200); }
					 }
				],
				height: 'auto',
				autowidth:true,
				regional : "es",
				rowList: [],
				pgbuttons: false,
				pgtext: null,
				viewrecords: false,
				loadonce : false,
				height: '100%',
				emptyDataText:'No hay datos',
				pager: "#" + childGridPagerID,
				editurl: '/editProjectForPanel',
				ajaxRowOptions: { contentType: "application/json" },
				serializeRowData: function (data) { return JSON.stringify(data); }
			});

			$("#" + childGridID).jqGrid('navGrid', "#" + childGridPagerID,
			{ edit: false, add: true, del: true, search: false, refresh: false, view: false, position: "left", cloneToTop: false },
				{
				},
				{
					addCaption: "Agregar Proyecto",
					mtype: 'POST',
					height: 'auto',
					width: 'auto',
					modal: true,
					template: tmplServ,
					ajaxEditOptions: jsonOptions,
					serializeEditData: createJSON,
					closeAfterAdd: true,
					recreateForm: true,
					errorTextFormat: function (data) {
						return 'Error: ' + data.responseText
					},
					afterSubmit : function(response,postdata){
						var json   = response.responseText;
						var result = JSON.parse(json);
						if(result.error_code!=0)
							return [false,result.error_text,""];
						else
							return [true,"",""]
					}, beforeSubmit : function (postdata, formid) {
						if ( $.trim(postdata.project) == '0') {
							return [false,"Debe escoger un proyecto",""];
						} else {
							return [true,"",""]
						}
					}, beforeShowForm: function (form) {
					    console.log("***panel:"+parentRowKey);
                        $('#id_panel',form).val(parentRowKey);
                        $('#project',form).hide();
					}
				},
				{
					mtype: 'GET',
					height: 'auto',
					url: '/panelProjectDelete',
					width: 'auto',
					errorTextFormat: function (data) {
						return 'Error: ' + data.responseText
					}
				}
			);

		}
							
		$("#dialog-edit-member-capacity").dialog({
					autoOpen: false,
		            modal: true,
		            resizable: true,
		            open: function(event, ui) {
			        	//$("#scroll38").setGridHeight($(this).height()-54);
			        	$("#scroll38").setGridHeight($(this).height());
			        	$("#scroll38").setGridWidth($(this).width(), true);				
			    	},resizeStop: function(event, ui) {
			        	//$("#scroll38").setGridHeight($(this).height()-54);
			        	$("#scroll38").setGridHeight($(this).height());
			        	$("#scroll38").setGridWidth($(this).width(), true);
    				}, position: 'center',
					show: {
		              effect: "blind",
		              duration: 1000
		          	},
					hide: {
		              effect: "explode",
		              duration: 1000
					}
		});		
		
		$("#dialog-edit-panel").dialog({
					autoOpen: false,
		            modal: true,
		            resizable: true,
		            open: function(event, ui) {
			        	$("#scroll39").setGridHeight($(this).height()+100);
			        	$("#scroll39").setGridWidth($(this).width(), true);				
			    	},resizeStop: function(event, ui) {
			        	$("#scroll39").setGridHeight($(this).height()+100);
			        	$("#scroll39").setGridWidth($(this).width(), true);
    				}, position: 'center',
					show: {
		              effect: "blind",
		              duration: 1000
		          	},
					hide: {
		              effect: "explode",
		              duration: 1000
					},
					close: function(event, ui){
						$.get("/get-program-panels/"+$("#program").val(), function(j){
							$('#panelcombobox option').remove();
							$('#panelcombobox').append(j);
						});
					}
		});		
	Highcharts.setOptions({
		lang: {
			months: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',  'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],	
			shortMonths: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul','Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
			weekdays: ['Domingo', 'Lunes', 'Martes', 'Mi�rcoles', 'Jueves', 'Viernes', 'S�bado']
		}
	});
	
	$("#distribution").dialog({
			autoOpen: false,
            width: 800,
            height: 600,
            position: 'center',
	          show: {
	              effect: "blind",
	              duration: 1000
	          },
	          hide: {
	              effect: "explode",
	              duration: 1000
	          }
	});	
	$('a.interno').click(function(event) { 
		event.preventDefault();
		renderDistributionGraph(this.href,this.id)
    }); 
    
   	$('a.externo').click(function(event) { 
   		event.preventDefault();
		//renderDistributionGraph(this.href,$(this).parent().find('.provider').text());
		renderDistributionGraph(this.href,this.id)
    });  
	
	$(".show-project-details").data('powertip',function() {
		var _this= $(this);
		var id= _this.attr("id").split("_")[1];
		var context = $("#show_pr_"+id).text();
		return context;
	});

	$(".show-project-details").powerTip({
		placement : 'n', 
		mouseOnToPopup : true
	});
	 
	//Recibe los datos de los graficos y los pinta
	function generaGraficos(json_var) {
	  var items = [];
	  var items2 = [];
	  var items3 = [];
	  var items4 = [];
	  var items5 = [];
	  var items6 = [];
	  var items7 = [];
	  var items8 = [];
	  var items9 = [];
	  var items10 = [];
	  var items11 = [];
	  var items12 = [];
	  var items13 = [];	
	 
		if("empty_object" === json_var.empty_object){
			 $("#container_id").hide();
			  $("#container_2").hide();
			  $("#container_3").hide();
			   $("#productNm_earnedvalueanalysis").hide();
		}else{
	 
		  var json_data = json_var.spi_date_map
		  var json_data2 = json_var.cpi_date_map
		  var json_data6 = json_var.ecpi_date_map
		  var json_data7 = json_var.espi_date_map
		  
		  var json_data3 = json_var.actual_cost_map
		   var json_data4 = json_var.earn_value_map
		   var json_data5 = json_var.planned_value_map
		  
		   var json_data8 = json_var.e_actual_cost_map
		   var json_data9 = json_var.e_earn_value_map
		   var json_data10 = json_var.e_planned_value_map
		  
		   
		   var json_data11 = json_var.ta
		   var json_data12 = json_var.tp
		   
		   var programIdMap = json_var.program_id
								  
		  for (x in programIdMap) {
				 var date = x
				 var d = new Date(parseInt(date));
				 items13.push([Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()),programIdMap[x]]);
				 items13.sort(function(a, b){
									if (a < b) return -1;
									if (b < a) return 1;
									return 0;
								});
			}
		  
		  for (x in json_data6) {
				 var date = x
				 var d = new Date(parseInt(date));
				 items6.push([Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()),json_data6[x]]);
				 items6.sort(function(a, b){
									if (a < b) return -1;
									if (b < a) return 1;
									return 0;
								});
			}
		  
		  for (x in json_data7) {
				 var date = x
				 var d = new Date(parseInt(date));
				 items7.push([Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()),json_data7[x]]);
				 items7.sort(function(a, b){
									if (a < b) return -1;
									if (b < a) return 1;
									return 0;
								});
			}
		  
		  for (x in json_data8) {
				 var date = x
				 var d = new Date(parseInt(date));
				 items8.push([Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()),json_data8[x]]);
				 items8.sort(function(a, b){
									if (a < b) return -1;
									if (b < a) return 1;
									return 0;
								});
			}
		  
		  for (x in json_data9) {
				 var date = x
				 var d = new Date(parseInt(date));
				 items9.push([Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()),json_data9[x]]);
				 items9.sort(function(a, b){
									if (a < b) return -1;
									if (b < a) return 1;
									return 0;
								});
			}
		  
		  for (x in json_data10) {
				 var date = x
				 var d = new Date(parseInt(date));
				 items10.push([Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()),json_data10[x]]);
				 items10.sort(function(a, b){
									if (a < b) return -1;
									if (b < a) return 1;
									return 0;
								});
			}
		  
			 for (x in json_data5) {
				 var date = x
				 var d = new Date(parseInt(date));
				 items5.push([Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()),json_data5[x]]);
				 items5.sort(function(a, b){
									if (a < b) return -1;
									if (b < a) return 1;
									return 0;
								});
			}
			  
			for (x in json_data4) {
				 var date = x
				 var d = new Date(parseInt(date));
				 items4.push([Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()),json_data4[x]]);
				 items4.sort(function(a, b){
									if (a < b) return -1;
									if (b < a) return 1;
									return 0;
								});
			} 
		  
			for (x in json_data3) {
				 var date = x
				 var d = new Date(parseInt(date));
				 items3.push([Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()),json_data3[x]]);
				 items3.sort(function(a, b){
									if (a < b) return -1;
									if (b < a) return 1;
									return 0;
								});
			}
		  
			for (x in json_data2) {
				 var date = x
				 var d = new Date(parseInt(date));
				 items2.push([Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()),json_data2[x]]);
				 items2.sort(function(a, b){
									if (a < b) return -1;
									if (b < a) return 1;
									return 0;
								});
			} 
			  
			 for (x in json_data) {
				 var date = x
				 var d = new Date(parseInt(date));
				 items.push([Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()),json_data[x]]);
				 items.sort(function(a, b){
									if (a < b) return -1;
									if (b < a) return 1;
									return 0;
								});
			}
			
			 
			 for (x in json_data11) {
				 var date = x
				 var d = new Date(parseInt(date));
				 items11.push([Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()),json_data11[x]]);
				 items11.sort(function(a, b){
									if (a < b) return -1;
									if (b < a) return 1;
									return 0;
								});
			}
			 
			for (x in json_data12) {
				 var date = x
				 var d = new Date(parseInt(date));
				 items12.push([Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()),json_data12[x]]);
				 items12.sort(function(a, b){
									if (a < b) return -1;
									if (b < a) return 1;
									return 0;
								});
			}
		}

		Highcharts.setOptions({ // This is for all plots, change Date axis to local timezone
			global : {
				useUTC : false
			},
		
			 chart: {
					backgroundColor: {
						linearGradient: [0, 0, 500, 500],
						stops: [
							[0, 'rgb(255, 255, 255)'],
							[1, 'rgb(240, 240, 255)'],
							[2, 'rgb(68, 11, 182)'],
							[3, 'rgb(11, 182, 176)']
							]
					},
				   // borderWidth: 2,
					plotBackgroundColor: 'rgba(255, 255, 255, .9)',
				   // plotShadow: true,
					plotBorderWidth: 1
				}
		});
		var now = new Date;
		var chart1 = new Highcharts.Chart({
			chart : {
				renderTo : 'container_id',
				zoomType : 'xy'
			},
			title: {
					text: 'Gráfico Porcentaje de Avance'
			},
			xAxis : {
				type : 'datetime',
				plotLines: [{
								value: Date.UTC(now.getUTCFullYear(),now.getUTCMonth(), now.getUTCDate()),
								width: 1,
								color: 'red',
								dashStyle: 'dash',
								label: {
									text: 'Hoy',
									align: 'right',
									y: 12,
									x: 0
								}
							}]										
			},yAxis: {
				title: {
					text: 'Porcentaje'
				}
			},
			series : [ /*{
				name: 'SPI (100%)',
				data : items
			}, {
				name: 'CPI (100%)',
				data: items2
			},*/{
				name: '% Avance Informado',
				data: items6
			},{
				name: '% Avance Esperado',
				data: items7
			}]

		});
		
		
		var chart2 = new Highcharts.Chart({
			chart : {
				renderTo : 'container_3',
				zoomType : 'xy',
			},
			
			plotOptions: {
				series: {
					stickyTracking: false,
					events: {
						click: function(evt) {
							var index = evt.point.index;
							var programId = items13[index][1];
							var date = items13[index][0]
						}                      
					}
					
				}
			},
			
			title: {
					text: 'Gráfico de Sub-Tareas'
			},
			xAxis : {
				type : 'datetime',
				plotLines: [{
								value: Date.UTC(now.getUTCFullYear(),now.getUTCMonth(), now.getUTCDate()),
								width: 1,
								color: 'red',
								dashStyle: 'dash',
								label: {
									text: 'Hoy',
									align: 'right',
									y: 12,
									x: 0
								}
							}]											
			},
			yAxis: {
				title: {
					text: 'sub-tareas'
				}
			},
			series : [ {
				name: 'Sub-Tarea Atrasada',
				data : items11
			}, {
				name: 'Sub-Tarea Planeada',
				data: items12
			}]
			

		});
		
		var chart3 = new Highcharts.Chart({

			chart : {
				renderTo : 'container_2',
				zoomType : 'xy'
			},
				   title: {
					text: 'Gráfico Valor Ganado'
				},

			xAxis : {
				type : 'datetime',
				plotLines: [{
								value: Date.UTC(now.getUTCFullYear(),now.getUTCMonth(), now.getUTCDate()),
								width: 1,
								color: 'red',
								dashStyle: 'dash',
								label: {
									text: 'Hoy',
									align: 'right',
									y: 12,
									x: 0
								}
							}]										
			},yAxis: {
				title: {
					text: 'Horas'
				}
			},
			series : [ {
				name: 'HC (100%)',
				data : items3
			}, {
				name: 'VG (100%)',
				data: items4
			} ,{
				name :'Horas Asignadas',
				data: items5
			},{
				name :'HC (% Avance)',
				data: items10
			}
		 ,{
				name :'VG (% Avance)',
				data: items9
			}]
		});
	} //Fin generaGraficos
		
    $("#panelcombobox").change(function(){
		
        var panel = $(this).val();	
		console.log("Actualizando");
		renderProgramEarnValuePanel(panel, $("#program").val());
		renderProgramEarnValuePanelpro(panel, $("#program").val());
		//Actualiza graficos
		var url ="/get-spi-graph?program_id=@program.get.program_id&panel_id="+panel;
		$.get(url, function(data) {
			var json_var = $.parseJSON(data);				  
			generaGraficos(json_var);
		});
	});
	
	$.get("/get-program-panels/"+$("#program").val(), function(j){
		$('#panelcombobox option').remove();
		$('#panelcombobox').append(j);
	});		
	
		programSubtaskPagination();
			
		$('.estimated_cost_program').mask('000.000.000', {reverse: true});
		$(".planned_hours").keypress(function (e) {
		 //if the letter is not digit then display error and don't type anything
		 if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
			//display error message
			return false;
		}
	   });
		
	  @if(projectList.size!=0 && utils.UserAccess.checkAccess(req,"project_gantt")){
			var url ="/get-spi-graph?program_id=@program.get.program_id&panel_id=0";
			$.get(url, function(data) {
				var json_var = $.parseJSON(data);				  
				generaGraficos(json_var);
			});
		}	
		
		@if(projectList.size!=0 && utils.UserAccess.checkAccess(req,"project_gantt")){	
			renderProjectGanttChart();
		}
		
		renderProgramEarnValue($("#program").val());
		renderProgramEarnValuepro($("#program").val());
		var changeSet = $("#program_changeset").val();
		var relelaseDateChanges = "";
		var programHoursChanges = "";
		var initialPlannedDateChanges = "";
		var clouserDateChanges = "";
		if (changeSet != '') {
			var jsonObj = $.parseJSON(changeSet);
			$.each(jsonObj,function(idx, obj) {
				if (obj.fieldName == "initiation_planned_date") {
					initialPlannedDateChanges = initialPlannedDateChanges
							+ "<span style='text-decoration: line-through;'>"
							+ obj.org_value
							+ "</span><br>";
				} else if (obj.fieldName == "closure_date") {
					clouserDateChanges = clouserDateChanges
							+ "<span style='text-decoration: line-through;'>"
							+ obj.org_value
							+ "</span><br>";
				} else if (obj.fieldName == "release_date") {
					relelaseDateChanges = relelaseDateChanges
							+ "<span style='text-decoration: line-through;'>"
							+ obj.org_value
							+ "</span><br>";
				} else if (obj.fieldName == "programs_hours") {
					programHoursChanges = programHoursChanges
							+ "<span style='text-decoration: line-through;'>"
							+ obj.org_value
							+ "</span><br>";
				}
			});
		}
		$('.program-data')
			.data(
				'powertip',
				function() {
					if ($(this).attr('id') == "clouser_date") {
						return clouserDateChanges;
					} else if ($(this).attr('id') == "initial_planned_date") {
						return initialPlannedDateChanges;
					} else if ($(this).attr('id') == "release_date") {
						return relelaseDateChanges;
					} else if ($(this).attr('id') == "planned_hours") {
						return programHoursChanges;
					}

				});

		$('.program-data').powerTip({
			placement : 'ne', // north-east tooltip position
			mouseOnToPopup : true
		});
		$(".edit_member").on("click", editProgramMember);	
		$(".edit_paneles").on("click", editPaneles);
		$(".member-action").on("click", renderProgramMember);
		$(".member-action-external").on("click", renderProgramMemberExternal);
			
		$(".delete_icon-project").on("click", renderProjectSoftdelete);
		
		
		$(".estimated_cost_program").keydown(function (e) {
			if ((!e.shiftKey && !e.ctrlKey && !e.altKey) && ((e.keyCode >= 48 && e.keyCode <= 57) ||
			(e.keyCode >= 96 && e.keyCode <= 105))) {
			}
			else if (e.keyCode != 8 && e.keyCode != 46 && e.keyCode != 37 && e.keyCode != 39 &&
						 e.keyCode != 9) {
				e.preventDefault();
			}
		});
		$(".planned_hours").keydown(function (e) {
			if ((!e.shiftKey && !e.ctrlKey && !e.altKey) && ((e.keyCode >= 48 && e.keyCode <= 57) ||
			(e.keyCode >= 96 && e.keyCode <= 105))) {
			}
			else if (e.keyCode != 8 && e.keyCode != 46 && e.keyCode != 37 && e.keyCode != 39 &&
						 e.keyCode != 9) {
				e.preventDefault();
			}
		});
	    
});
</script>
</body>	
</html>
