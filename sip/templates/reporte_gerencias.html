<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
    body {
        font-family: "Helvetica Neue", Helvetica, Arial;
        font-size: 14px;
        line-height: 20px;
        font-weight: 400;
        color: #3b3b3b;
        -webkit-font-smoothing: antialiased;
        font-smoothing: antialiased;
        //background: #2b2b2b;
        background: #FFFFFF;
    }
    
    .wrapper {
        margin: 0 auto;
        padding: 40px;
        max-width: 800px;
    }
    
    .table {
        margin: 0 0 40px 0;
        width: 100%;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        display: table;
    }
    
    @media screen and (max-width: 580px) {
        .table {
            display: block;
        }
    }
    
    .row {
        display: table-row;
        background: #f6f6f6;
    }
    
    .row:nth-of-type(odd) {
        background: #e9e9e9;
    }
    
    .row.header {
        font-weight: 900;
        color: #ffffff;
        background: #ea6153;
    }
    
    .row.green {
        background: #27ae60;
    }
    
    .row.blue {
        background: #2980b9;
    }
    
    @media screen and (max-width: 580px) {
        .row {
            padding: 8px 0;
            display: block;
        }
    }
    
    .cell {
        padding: 6px 12px;
        display: table-cell;
    }
    
    .cellamount {
        padding: 6px 12px;
        display: table-cell;
        text-align: right;
    }
    
    @media screen and (max-width: 580px) {
        .cell {
            padding: 2px 12px;
            display: block;
        }
    }
    
    #placeholder {
        width: 800px;
        height: 500px;
        position: relative;
        margin: 0 auto;
    }
    
    .chart-container {
        box-sizing: border-box;
        width: 100%;
        padding: 20px 15px 15px 15px;
        margin: 15px auto 30px auto;
        border: 1px solid #ddd;
        background: #fff;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
        -o-box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        -ms-box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        -moz-box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        -webkit-box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    
    .chart-placeholder {
        width: 100%;
        height: 90px;
        font-size: 14px;
        line-height: 1em;
    }
</style>

<div class="wrapper">

    <div class="table">

        <div class="row header">
            <div class="cell">
                Gerencia
            </div>
            <div class="cellamount">
                2016
            </div>
            <div class="cellamount">
                2017
            </div>
            <div class="cellamount">
                Diferencia
            </div>
            <div class="cellamount">
                Porcentaje
            </div>
        </div>
        {{#each gerencias}}
        <div class="row">
            <div class="cell">
                {{nombre}}
            </div>
            <div class="cellamount">
                {{format ejerciciouno}}
            </div>
            <div class="cellamount">
                {{format ejerciciodos}}
            </div>
            <div class="cellamount">
                {{format diferencia}}
            </div>
            <div class="cellamount">
                {{format porcentaje}}
            </div>
        </div>
        {{/each}}
        <div class="row">
            <div class="cell">
                <b>Total</b>
            </div>
            <div class="cellamount">
                <b>{{totalUno gerencias}}</b>
            </div>
            <div class="cellamount">
                <b>{{totalDos gerencias}}</b>
            </div>
            <div class="cellamount">
                <b>{{totalDiferencia gerencias}}</b>
            </div>
            <div class="cellamount">
                <b>{{totalPorcentaje gerencias}}</b>
            </div>
        </div>

    </div>

    <div class="chart-container" style="width:800px;height:600px;"></div>

</div>

<script src="http://localhost:3000/javascripts/jquery-1.12.3.min.js"></script>
<script src="http://localhost:3000/javascripts/flot/jquery.flot.min.js"></script>
<script src="http://localhost:3000/javascripts/flot/jquery.flot.categories.min.js"></script>
<script src="http://localhost:3000/javascripts/flot/jquery.flot.axislabels.min.js"></script>

<script>
    function DataUno(data){
        var res = [];
        $.each(data, function(i, item){
            res.push([item.nombre, item.ejerciciouno])
        });
        return res;
    }

    function DataDos(data){
        var res = [];
        $.each(data, function(i, item){
            res.push([item.nombre, item.ejerciciodos])
        });
        return res;
    }    

    $(function () {

        var data = {{{toJSON gerencias}}}
        var gerencias = data.map(function(b) { return [ b.id, b.nombre, b.ejerciciouno, b.ejerciciodos, b.diferencia, b.porcentaje ]});
		var serieUno = DataUno(data);
        var serieDos = DataDos(data);
		
        $.plot($(".chart-container"), 
                [{  data: serieUno,
                    bars: {
                        show: true,
                        barWidth: 0.2,
                        align: "left",
                    }
                },
                {
                    data: serieDos,
                    bars: {
                        show: true,
                        barWidth: 0.2,
                        align: "right",
                    }
                }
                ],
                {
                    xaxis: {
                        mode: "categories",
                        tickLength: 0
                    }
                }
        );
    });
</script>